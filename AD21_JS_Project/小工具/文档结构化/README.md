# 文档拆分工具使用说明

## 概述

这是一个用于将大型 Word 文档（.docx）按标题层级自动拆分为多个小文件的 Node.js 工具。

## 功能特性

- 🔄 **多层级深度拆分**：支持 1-5 级标题的递归拆分
- 📁 **智能目录结构**：一级标题创建主目录，二级标题创建子目录
- 📝 **自动文件命名**：中文和特殊字符自动转换为下划线
- 📏 **文件大小控制**：超过 80KB 自动二次拆分
- 🔗 **导航文件生成**：自动生成 README.md 和 INDEX.md 导航文件
- 🎯 **精确内容提取**：按标题层级精确提取对应内容

## 安装依赖

```bash
npm install mammoth fs-extra
```

## 使用方法

### 基本使用

```bash
node document-splitter.js
```

### 配置说明

在 `document-splitter.js` 中的 `CONFIG` 对象可以修改以下配置：

```javascript
const CONFIG = {
    inputFile: '参考示例/1.接口文档/Scripting API.docx',  // 输入文件路径
    outputDir: 'output',                                      // 输出目录
    maxFileSize: 80 * 1024,                                   // 文件大小限制（80KB）
    encoding: 'utf8'                                            // 文件编码
};
```

## 输出结构

### 目录层级规则

```
output/
├── INDEX.md                           # 主索引文件
├── 01-一级标题名/                     # 一级标题 → 主目录
│   ├── README.md                      # 目录导航文件
│   ├── 01-二级标题名/                 # 二级标题 → 子目录
│   │   ├── README.md                  # 子目录导航
│   │   ├── 01-三级标题名.md           # 三级标题 → 文件
│   │   └── 02-三级标题名.md
│   └── 02-二级标题名/
└── 02-一级标题名/
```

### 文件命名规则

- **目录名**：`NN-标题名/`（中文转下划线）
- **文件名**：`NN-标题名.md`（中文转下划线）
- **拆分文件**：`NN-标题名-part1.md`, `NN-标题名-part2.md`
- **序号规则**：每层重新编号（01, 02, 03...）

## 拆分示例

### 输入文档结构
```markdown
# 一级标题A
## 二级标题A1
### 三级标题A1.1
内容...
### 三级标题A1.2
内容...
## 二级标题A2
### 三级标题A2.1
内容...

# 一级标题B
## 二级标题B1
### 三级标题B1.1
内容...
```

### 输出结构
```
output/
├── INDEX.md
├── 01-一级标题A/
│   ├── README.md
│   ├── 01-二级标题A1/
│   │   ├── README.md
│   │   ├── 01-三级标题A1.1.md
│   │   └── 02-三级标题A1.2.md
│   └── 02-二级标题A2/
│       ├── README.md
│       └── 01-三级标题A2.1.md
└── 02-一级标题B/
    ├── README.md
    └── 01-二级标题B1/
        ├── README.md
        └── 01-三级标题B1.1.md
```

## 核心算法

### 1. 标题解析
- 使用正则表达式提取各级标题
- 构建层级树结构
- 按位置排序确保顺序正确

### 2. 内容提取
- 精确提取标题间内容
- 递归处理子标题内容
- 保持内容完整性

### 3. 文件大小控制
- 检查文件大小是否超过限制
- 按下一级标题拆分
- 按段落拆分作为最后手段

### 4. 导航生成
- 每个目录生成 README.md
- 生成主索引 INDEX.md
- 自动创建相对路径链接

## 技术特点

- **内存高效**：流式处理大文件
- **错误处理**：完善的异常处理机制
- **编码安全**：正确处理中文和特殊字符
- **路径安全**：自动创建必要的目录结构
- **日志详细**：详细的处理过程日志

## 注意事项

1. **文档格式**：确保输入的 .docx 文件有清晰的标题层级结构
2. **文件大小**：超大文件会自动拆分，但可能产生较多小文件
3. **中文处理**：所有中文字符会转换为下划线
4. **路径长度**：注意 Windows 系统的路径长度限制

## 扩展功能

可以根据需要扩展以下功能：

- 支持其他文档格式（.doc, .rtf 等）
- 自定义文件命名规则
- 自定义文件大小限制
- 支持更多标题级别
- 添加文档内容过滤功能

## 故障排除

### 常见问题

1. **文件不存在**：检查输入文件路径是否正确
2. **权限错误**：确保有读写权限
3. **内存不足**：对于超大文件，考虑增加系统内存
4. **编码问题**：确保文档使用标准编码格式

### 调试模式

可以在脚本中添加调试信息：

```javascript
console.log('解析到的标题：', headers);
console.log('文件大小：', Utils.formatFileSize(fileSize));
```

## 许可证

本工具基于 MIT 许可证开源。
