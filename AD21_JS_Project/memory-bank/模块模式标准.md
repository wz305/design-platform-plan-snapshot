# ğŸ“„ **module-patterns.md**  
ï¼ˆæ¨¡å—æ¨¡å¼ï¼šBaseModuleæ¶æ„æ ‡å‡†ï¼‰

```markdown
# Module Patternsï¼ˆAD ES3 BaseModuleæ¶æ„ï¼‰

æœ¬æ–‡ä»¶æè¿°åŸºäºBaseModuleçš„æ¨¡å—æ ‡å‡†ç»“æ„å’Œä½¿ç”¨æ¨¡å¼ã€‚  
Cline å¿…é¡»åœ¨æ‰€æœ‰ç”Ÿæˆä»£ç ä¸­éµå¾ªæ­¤æ¶æ„ã€‚

---

## 1. æ ¸å¿ƒæ¶æ„ï¼šBaseModuleæ¨¡æ¿

### BaseModuleç‰¹ç‚¹
- **é€šç”¨æ€§æå¼º**ï¼šé€‚ç”¨äºä»»ä½•ç±»å‹çš„æ¨¡å—
- **ES3å…¼å®¹**ï¼š100%å…¼å®¹JScript 5.8
- **å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ï¼šcreate/init/run/destroy
- **Hookç³»ç»Ÿ**ï¼šbefore/afteræ¯ä¸ªç”Ÿå‘½å‘¨æœŸ
- **çŠ¶æ€ç®¡ç†**ï¼šå†…ç½®çŠ¶æ€ã€ä¸Šä¸‹æ–‡ã€é”™è¯¯å¤„ç†

### æ¨¡å—ç»§æ‰¿æ¨¡å¼
æ‰€æœ‰æ¨¡å—å¿…é¡»åŸºäºBaseModuleåˆ›å»ºï¼š

```javascript
var MyModule = (function(){
    // ç»§æ‰¿BaseModuleçš„æ ¸å¿ƒé€»è¾‘
    // é‡å†™_performInitializationå®ç°å…·ä½“åˆå§‹åŒ–
    // é‡å†™_executeMainLogicå®ç°ä¸šåŠ¡é€»è¾‘
    // é‡å†™_performDestroyå®ç°èµ„æºæ¸…ç†
    
    return {
        create: create
    };
})();
```

---

## 2. æ ‡å‡†æ¨¡å—ç»“æ„

### æ­ç¤ºæ¨¡å—æ¨¡å¼ï¼ˆå¼ºåˆ¶ï¼‰
```javascript
var ModuleName = (function(){
    // 1. ç§æœ‰å˜é‡å’Œå‡½æ•°
    var _privateConfig = {};
    var _privateHelper = function(){};
    
    // 2. å…¬æœ‰APIå‡½æ•°
    function create(options){
        // åŸºäºBaseModuleåˆ›å»ºå®ä¾‹
    }
    
    function init(instance){
        // åˆå§‹åŒ–å®ä¾‹
    }
    
    function run(instance){
        // è¿è¡Œå®ä¾‹
    }
    
    function destroy(instance){
        // é”€æ¯å®ä¾‹
    }
    
    // 3. æ¸…æ™°å¯¼å‡ºå…¬æœ‰æ¥å£
    return {
        create: create,
        init: init,
        run: run,
        destroy: destroy
        // ç§æœ‰å‡½æ•°æœªæš´éœ²ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®
    };
})();
```

---

## 3. æ¨¡å—ä½¿ç”¨æ¨¡å¼ï¼ˆå¼ºåˆ¶ï¼‰

### æ ‡å‡†ä½¿ç”¨æµç¨‹
```javascript
// 1. åˆ›å»ºå®ä¾‹
var instance = ModuleName.create({
    moduleName: "MyModule",
    autoInit: true,
    autoTime: true
});

// 2. åˆå§‹åŒ–ï¼ˆå¦‚æœautoInitä¸ºfalseï¼‰
ModuleName.init(instance);

// 3. è¿è¡Œ
var result = ModuleName.run(instance);

// 4. é”€æ¯
ModuleName.destroy(instance);
```

### Hookä½¿ç”¨ç¤ºä¾‹
```javascript
var instance = ModuleName.create({
    moduleName: "MyModule"
});

// è®¾ç½®Hook
instance.hooks.onBeforeInit = function(inst){
    // åˆå§‹åŒ–å‰å¤„ç†
};

instance.hooks.onAfterRun = function(inst, result){
    // è¿è¡Œåå¤„ç†
};
```

---

## 4. å®ä¾‹ç»“æ„ï¼ˆBaseModuleæ ‡å‡†ï¼‰

æ¯ä¸ªå®ä¾‹è‡ªåŠ¨åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```javascript
instance = {
    // é…ç½®é€‰é¡¹
    options: {
        moduleName: "ModuleName",
        autoInit: false,
        autoTime: true
    },
    
    // è¿è¡ŒçŠ¶æ€
    state: {
        initialized: false,
        running: false,
        destroyed: false,
        errorCount: 0,
        lastError: null
    },
    
    // æ‰§è¡Œä¸Šä¸‹æ–‡
    context: {
        startTime: null,
        endTime: null,
        executionTime: 0
    },
    
    // Hookç³»ç»Ÿ
    hooks: {
        onBeforeInit: null,
        onAfterInit: null,
        onBeforeRun: null,
        onAfterRun: null,
        onBeforeDestroy: null,
        onAfterDestroy: null
    },
    
    // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    init: function(){ return init(instance); },
    run: function(){ return run(instance); },
    destroy: function(){ return destroy(instance); }
}
```

---

## 5. å¯é‡å†™çš„å†…éƒ¨æ–¹æ³•

### _performInitialization(inst)
- **ç”¨é€”**ï¼šæ‰§è¡Œå…·ä½“çš„åˆå§‹åŒ–é€»è¾‘
- **å‚æ•°**ï¼šæ¨¡å—å®ä¾‹
- **è¿”å›å€¼**ï¼šBooleanï¼Œæ˜¯å¦æˆåŠŸ
- **ç¤ºä¾‹**ï¼š
```javascript
function _performInitialization(inst) {
    // å…·ä½“çš„åˆå§‹åŒ–é€»è¾‘
    inst.logger = Logger.create(inst.options.moduleName);
    return true;
}
```

### _executeMainLogic(inst)
- **ç”¨é€”**ï¼šæ‰§è¡Œä¸»è¦çš„ä¸šåŠ¡é€»è¾‘
- **å‚æ•°**ï¼šæ¨¡å—å®ä¾‹
- **è¿”å›å€¼**ï¼šObjectï¼Œæ‰§è¡Œç»“æœ
- **ç¤ºä¾‹**ï¼š
```javascript
function _executeMainLogic(inst) {
    return {
        success: true,
        message: "Execution completed",
        data: null,
        time: inst.context.executionTime
    };
}
```

### _performDestroy(inst)
- **ç”¨é€”**ï¼šæ‰§è¡Œèµ„æºæ¸…ç†é€»è¾‘
- **å‚æ•°**ï¼šæ¨¡å—å®ä¾‹
- **è¿”å›å€¼**ï¼šBooleanï¼Œæ˜¯å¦æˆåŠŸ
- **ç¤ºä¾‹**ï¼š
```javascript
function _performDestroy(inst) {
    // æ¸…ç†èµ„æº
    return true;
}
```

---

## 6. æ—¥å¿—è®°å½•è§„èŒƒ

### æ—¥å¿—æ ¼å¼ï¼ˆå¼ºåˆ¶ï¼‰
```javascript
"[ModuleName][fileName][functionName] message"
```

### æ—¥å¿—è®°å½•ç¤ºä¾‹
```javascript
function _performInitialization(inst) {
    if (typeof Logger !== "undefined") {
        inst.logger = Logger.create(inst.options.moduleName);
        inst.logger.debug("[MyModule][core.js][_performInitialization] Starting initialization");
    }
    return true;
}
```

---

## 7. DFMå‡½æ•°ç‰¹æ®Šè§„åˆ™

### DFMå‡½æ•°å®šä¹‰ï¼ˆå¼ºåˆ¶ï¼‰
```javascript
function Button1Click(Sender) {
    try {
        var module = ModuleName.create({moduleName: "ButtonClickHandler"});
        ModuleName.init(module);
        var result = ModuleName.run(module);
        ModuleName.destroy(module);
        
        // å¤„ç†ç»“æœ
        
    } catch (error) {
        // é”™è¯¯å¤„ç†
    }
}
```

### DFMå‡½æ•°è¦æ±‚
- **å¿…é¡»**ï¼šç›´æ¥åœ¨å…¨å±€ä½œç”¨åŸŸå®šä¹‰
- **å¿…é¡»**ï¼šåŒ…å«Senderå‚æ•°
- **ä¸¥ç¦**ï¼šä½¿ç”¨IIFEåŒ…è£…
- **å¿…é¡»**ï¼šåœ¨src/core/global-events.jsä¸­å®šä¹‰

---

```
