# 📄 **项目基础文档.md**

（项目基础文档，所有其他文件的基础）

````markdown
# Project Brief - AD ES3 模块化开发体系

## 项目概述

本项目为 Altium Designer (AD) 脚本环境提供 ES3 模块化开发体系。目标是创建稳定、可维护的模块结构，支持复杂的 PCB 检查和拓扑分析功能。

## 项目需求（长期）

- 模块必须可批量实例化  
- 拓扑、图结构、几何等数据结构为常用需求  
- 日志是核心调试手段  
- 构建过程必须稳定、可自动化  

## AD 环境特点（长期不变）

- 支持 JScript 5.8（相当于 ES3）
- 不支持 import/require
- 不支持现代 JS 标准库
- 脚本运行在单线程环境
- 必须通过 main.js 与 main.PrjScr 部署

## 核心目标

### 1. 环境兼容性
- 100% 兼容 AD JScript 5.8 环境
- 支持 ES3 语法，无任何 ES5+ 特性
- 单线程执行模型
- 全局作用域变量管理

### 2. 模块化架构
- 基于大IIFE的统一模块模式
- 揭示模块模式 (Revealing Module Pattern)
- 完整的生命周期管理
- 零配置模块系统

### 3. 开发效率
- AI 辅助代码生成 (Cline)
- 标准化的协商流程
- 自动化构建和测试
- 完整的文档体系

## 技术约束

### AD 环境限制
- 不支持 `this` 关键字
- 不存在 `window` 全局对象
- 不支持 `require/import` 模块系统
- 不支持现代 JavaScript API

### JavaScript 环境
- JScript 5.8  
- 相当于 ES3  
- 无浏览器 API  
- 无 module system  

### 语法要求
- 必须使用 `var` 声明变量
- 必须使用 `function` 声明函数
- 必须使用传统 `for` 循环
- 必须使用双引号字符串

### 可用特性
- var  
- function  
- prototype  
- Simple objects and arrays  
- for loops  

### 不可用特性
- ES5+ methods (map, filter, reduce...)  
- ES6 syntax (let, const, arrow functions)  
- Class syntax  
- Promise/async  
- require/import  

### 运行模型
- 无并发  
- 无异步  
- 全局作用域敏感  
- 必须控制内存占用

## 构建流程

```mermaid
flowchart TD

A[build.json] --> B[combine.js: Merge Source Files]
B --> C[main_utf8.js]
C --> D[Encoding: UTF8 → GB2312]
D --> E[main.js (AD Executable)]
E --> F[Copy main.dfm + project.PrjScr to dist/]
```

## 项目术语

- **Module**：一个可在 AD 中调用的功能单元，由 index/core/types/tools 等文件组成
- **Instance**：模块经构造函数创建的对象，包含 state/context/logger
- **Context**：模块在单次运行过程中的临时数据
- **State**：模块的长期运行状态
- **Step**：一个独立的业务操作单元，存放于 steps/
- **Logic**：复杂算法逻辑，存放于 logic/，不记日志
- **Build**：将所有模块文件合并成 main.js 的过程
- **Workflow**：用于自动化创建模块、测试、构建与审查的 Cline 工作流
- **Logger**：全局日志系统，唯一允许 debug/info/warn/error

## 项目范围

### 核心模块
1. **LoggerModule** - 日志系统
2. **ObjectModule** - 对象创建系统
3. **PCBInterfacesModule** - PCB接口封装
4. **CoreModule** - 核心功能模块

### 支持系统
1. **构建系统** - 文件拼接和编码转换
2. **测试系统** - Node.js 环境验证
3. **文档系统** - Memory Bank 和规则体系

## 成功标准

### 功能性
- 所有模块在 AD 环境中正常运行
- 完整的 PCB 检查功能
- 稳定的日志记录
- 可靠的拓扑分析

### 质量性
- 代码符合 ES3 标准
- 模块间低耦合高内聚
- 完整的错误处理
- 清晰的文档和注释

### 可维护性
- 统一的代码结构
- 标准化的开发流程
- 自动化的测试验证
- 完整的变更记录

## 风险评估

### 高风险
- AD 环境兼容性问题
- ES3 语法约束复杂
- 现有日志系统重构

### 中风险
- 模块间依赖管理
- 构建流程稳定性
- 测试覆盖率

### 低风险
- 文档维护
- 代码规范执行
- 开发效率优化

## 里程碑

### 阶段一：规则重构 (已完成)
- [x] 大IIFE模块模式确立
- [x] 核心规则简化
- [x] Memory Bank 完善
- [x] 旧规则文件清理

### 阶段二：模块重构 (进行中)
- [x] LoggerModule重构完成
- [x] ObjectModule重构完成
- [x] PCBInterfacesModule重构完成
- [ ] CoreModule迁移
- [ ] DFM函数标准化

### 阶段三：功能完善 (待开始)
- [ ] PCB检查功能实现
- [ ] 拓扑分析算法优化
- [ ] 性能监控和调优

### 阶段四：测试部署 (待开始)
- [ ] 完整测试覆盖
- [ ] AD环境验证
- [ ] 文档完善
- [ ] 生产部署

````

**此文档是整个项目的基础，所有决策都应与此文档保持一致。**
