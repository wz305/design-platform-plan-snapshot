# Button1Click æ—¥å¿—ä¿å­˜åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`Button1Click` å‡½æ•°æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºä¿å­˜å½“å‰æ—¥å¿—åˆ°æŒ‡å®šç›®å½•çš„åŠŸèƒ½ã€‚å½“ç”¨æˆ·ç‚¹å‡»ç•Œé¢ä¸Šçš„"Save Log"æŒ‰é’®æ—¶ï¼Œè¯¥å‡½æ•°ä¼šè¢«è§¦å‘ï¼Œç«‹å³å°†æ‰€æœ‰ç¼“å­˜çš„æ—¥å¿—ä¿å­˜åˆ° `D:\System_Files\Documents\!AD19\peixun\å¼ å¤©å¥\ç¨‹åº\Altium Designer Script\Altium Designer 21 è„šæœ¬\Scripts\AD21_JS_Project\tests\reports\` ç›®å½•ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å³æ—¶ä¿å­˜**ï¼šç‚¹å‡»æŒ‰é’®ç«‹å³ä¿å­˜æ‰€æœ‰æ—¥å¿—ç¼“å­˜
- **è·¯å¾„åŠ¨æ€åˆ‡æ¢**ï¼šä¸´æ—¶ä¿®æ”¹æ—¥å¿—é…ç½®è·¯å¾„ï¼Œä¿å­˜åæ¢å¤
- **å¤šæ—¥å¿—æ”¯æŒ**ï¼šæ”¯æŒä¿å­˜å¤šä¸ª Logger å®ä¾‹çš„æ—¥å¿—
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆæœºåˆ¶

### æŠ€æœ¯ç‰¹æ€§
- **ES3 å…¼å®¹**ï¼šä¸¥æ ¼ä½¿ç”¨ ES3 è¯­æ³•ï¼Œå…¼å®¹ AD è„šæœ¬ç¯å¢ƒ
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šéµå¾ªé¡¹ç›®æ¨¡å—æ¶æ„è§„èŒƒ
- **æ—¥å¿—è§„èŒƒ**ï¼šç¬¦åˆé¡¹ç›®æ—¥å¿—æ ¼å¼æ ‡å‡†
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡ ProjectConfig åŠ¨æ€é…ç½®

## æ–‡ä»¶ç»“æ„

```
src/modules/ui/
â”œâ”€â”€ index.js          # UI æ¨¡å—ä¸»æ¥å£
â”œâ”€â”€ core.js            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ tools.js           # ç§æœ‰å·¥å…·å‡½æ•°
â”œâ”€â”€ types.js           # æ•°æ®ç»“æ„å®šä¹‰
â””â”€â”€ global-events.js   # å…¨å±€äº‹ä»¶å¤„ç†

ui/
â””â”€â”€ main.dfm           # ç•Œé¢å®šä¹‰æ–‡ä»¶

tests/
â”œâ”€â”€ mock-ad21.js       # AD ç¯å¢ƒæ¨¡æ‹Ÿ
â”œâ”€â”€ simple-button-test.js  # åŠŸèƒ½æµ‹è¯•
â””â”€â”€ ui-button-test.js  # å®Œæ•´æµ‹è¯•å¥—ä»¶
```

## ä½¿ç”¨æ–¹æ³•

### 1. ç•Œé¢é›†æˆ

åœ¨ `ui/main.dfm` ä¸­å·²æ·»åŠ ä¿å­˜æ—¥å¿—æŒ‰é’®ï¼š

```delphi
object btnSaveLog: TButton
  Left = 180
  Top = 10
  Width = 75
  Height = 30
  Caption = 'Save Log'
  TabOrder = 2
  OnClick = Button1Click
end
```

### 2. å‡½æ•°è°ƒç”¨

æŒ‰é’®ç‚¹å‡»ä¼šè‡ªåŠ¨è°ƒç”¨å…¨å±€ `Button1Click` å‡½æ•°ï¼š

```javascript
function Button1Click(Sender) {
    // è‡ªåŠ¨åˆå§‹åŒ– UI å®ä¾‹
    var uiInstance = initializeGlobalUI();
    
    // æ‰§è¡Œæ—¥å¿—ä¿å­˜
    uiInstance.Button1Click(Sender);
}
```

### 3. æ‰‹åŠ¨è°ƒç”¨

ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­æ‰‹åŠ¨è°ƒç”¨ï¼š

```javascript
// è·å–å…¨å±€ UI å®ä¾‹
var ui = getGlobalUI();

// æ‰§è¡Œæ—¥å¿—ä¿å­˜
var result = ui.executeLogSave();

// æ£€æŸ¥ç»“æœ
if (result.success) {
    console.log("ä¿å­˜æˆåŠŸï¼Œæ–‡ä»¶æ•°:", result.fileCount);
} else {
    console.log("ä¿å­˜å¤±è´¥:", result.errors);
}
```

## å·¥ä½œæµç¨‹

### 1. æŒ‰é’®ç‚¹å‡»è§¦å‘
```
ç”¨æˆ·ç‚¹å‡» btnSaveLog â†’ DFM è§¦å‘ OnClick â†’ è°ƒç”¨ Button1Click(Sender)
```

### 2. æ—¥å¿—ä¿å­˜æµç¨‹
```
1. ä¿å­˜åŸå§‹é…ç½®è·¯å¾„
2. ä¸´æ—¶è®¾ç½®ç›®æ ‡è·¯å¾„
3. å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ Logger å®ä¾‹
4. æ—¥å¿—å†™å…¥æ–°è·¯å¾„
5. æ¢å¤åŸå§‹é…ç½®
6. æ˜¾ç¤ºæ“ä½œç»“æœ
```

### 3. é”™è¯¯å¤„ç†
```
try {
    // æ‰§è¡Œä¿å­˜æ“ä½œ
} catch (error) {
    // è®°å½•é”™è¯¯æ—¥å¿—
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    // ç¡®ä¿é…ç½®æ¢å¤
} finally {
    // æ¸…ç†èµ„æº
}
```

## é…ç½®è¯´æ˜

### ç›®æ ‡è·¯å¾„
```javascript
var targetPath = "D:\\System_Files\\Documents\\!AD19\\peixun\\å¼ å¤©å¥\\ç¨‹åº\\Altium Designer Script\\Altium Designer 21 è„šæœ¬\\Scripts\\AD21_JS_Project\\tests\\reports\\";
```

### æ—¥å¿—é…ç½®
```javascript
// åŸå§‹é…ç½®
var originalPaths = ProjectConfig.get("logging.paths");

// ä¸´æ—¶é…ç½®
ProjectConfig.set("logging.paths", [targetPath]);

// æ¢å¤é…ç½®
ProjectConfig.set("logging.paths", originalPaths);
```

## æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œç®€åŒ–æµ‹è¯•
node tests/simple-button-test.js

# è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦æ„å»ºåçš„æ¨¡å—ï¼‰
node tests/ui-button-test.js
```

### æµ‹è¯•å†…å®¹
1. **UI å®ä¾‹åˆ›å»ºæµ‹è¯•**
2. **Button1Click å‡½æ•°æ‰§è¡Œæµ‹è¯•**
3. **æ—¥å¿—æ ¼å¼éªŒè¯æµ‹è¯•**
4. **è¿”å›å€¼ç»“æ„éªŒè¯æµ‹è¯•**
5. **æœªå£°æ˜å­—æ®µæ£€æŸ¥æµ‹è¯•**

### æµ‹è¯•ç»“æœç¤ºä¾‹
```
=== å¼€å§‹ Button1Click åŠŸèƒ½æµ‹è¯• ===

1. æµ‹è¯• UI å®ä¾‹åˆ›å»º...
âœ… UI å®ä¾‹åˆ›å»ºæˆåŠŸ

2. æµ‹è¯• Button1Click å‡½æ•°æ‰§è¡Œ...
âœ… Button1Click å‡½æ•°æ‰§è¡ŒæˆåŠŸ

3. æµ‹è¯•æ—¥å¿—æ ¼å¼éªŒè¯...
âœ… æ—¥å¿—æ ¼å¼éªŒè¯é€šè¿‡

4. æµ‹è¯•è¿”å›å€¼ç»“æ„éªŒè¯...
âœ… è¿”å›å€¼ç»“æ„éªŒè¯é€šè¿‡

=== æµ‹è¯•ç»“æœæ±‡æ€» ===
ğŸ‰ æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼
```

## è¾“å‡ºç¤ºä¾‹

### æˆåŠŸä¿å­˜æ¶ˆæ¯
```
=== æ—¥å¿—ä¿å­˜å®Œæˆ ===
ç›®æ ‡è·¯å¾„: D:\System_Files\Documents\!AD19\peixun\å¼ å¤©å¥\ç¨‹åº\Altium Designer Script\Altium Designer 21 è„šæœ¬\Scripts\AD21_JS_Project\tests\reports\
æ—¶é—´: 2025/12/7 22:57:00
===================
```

### é”™è¯¯æ¶ˆæ¯
```
=== æ—¥å¿—ä¿å­˜å¤±è´¥ ===
é”™è¯¯ä¿¡æ¯: [å…·ä½“é”™è¯¯ä¿¡æ¯]
æ—¶é—´: 2025/12/7 22:57:00
===================
```

## æ„å»ºéƒ¨ç½²

### 1. æ„å»ºå‘½ä»¤
```bash
cd build && node build.js
```

### 2. è¾“å‡ºæ–‡ä»¶
- `dist/main.js` - GB2312 ç¼–ç çš„ä¸»è„šæœ¬
- `dist/main_utf8.js` - UTF-8 æºç 
- `dist/main.dfm` - ç•Œé¢å®šä¹‰
- `dist/Main.PrjScr` - AD é¡¹ç›®æ–‡ä»¶

### 3. éƒ¨ç½²åˆ° AD
å°† `dist/` ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ° Altium Designer è„šæœ¬ç›®å½•å³å¯ã€‚

## æ‰©å±•åŠŸèƒ½

### è‡ªåŠ¨ä¿å­˜
```javascript
// å¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼ˆ5åˆ†é’Ÿé—´éš”ï¼‰
var ui = new UI({
    autoSaveEnabled: true,
    saveInterval: 300000
});
```

### è‡ªå®šä¹‰è·¯å¾„
```javascript
// ä½¿ç”¨è‡ªå®šä¹‰ä¿å­˜è·¯å¾„
var result = ui.executeLogSave("D:\\Custom\\Path\\");
```

### çŠ¶æ€æŸ¥è¯¢
```javascript
// è·å– UI çŠ¶æ€
var status = ui.getStatus();
console.log("æœ€åä¿å­˜æ—¶é—´:", status.lastSaveTime);
console.log("æˆåŠŸæ¬¡æ•°:", status.successCount);
```

## æ³¨æ„äº‹é¡¹

1. **è·¯å¾„æƒé™**ï¼šç¡®ä¿ç›®æ ‡è·¯å¾„æœ‰å†™å…¥æƒé™
2. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿ç›®æ ‡ç£ç›˜æœ‰è¶³å¤Ÿç©ºé—´
3. **æ—¥å¿—å¤§å°**ï¼šå¤§é‡æ—¥å¿—å¯èƒ½éœ€è¦è¾ƒé•¿ä¿å­˜æ—¶é—´
4. **å¹¶å‘è®¿é—®**ï¼šé¿å…åŒæ—¶å¤šæ¬¡ç‚¹å‡»ä¿å­˜æŒ‰é’®
5. **é…ç½®æ¢å¤**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ¢å¤åŸå§‹é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä¿å­˜å¤±è´¥**
   - æ£€æŸ¥ç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥å†™å…¥æƒé™
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **æŒ‰é’®æ— å“åº”**
   - æ£€æŸ¥ DFM æ–‡ä»¶æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å…¨å±€å‡½æ•°æ˜¯å¦æ­£ç¡®å¯¼å‡º
   - é‡æ–°æ„å»ºé¡¹ç›®

3. **æ—¥å¿—æ ¼å¼é”™è¯¯**
   - æ£€æŸ¥ Logger å®ä¾‹æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
   - éªŒè¯æ—¥å¿—æ ¼å¼æ˜¯å¦ç¬¦åˆè§„èŒƒ

### è°ƒè¯•æ–¹æ³•

1. **å¯ç”¨è°ƒè¯•æ—¥å¿—**
   ```javascript
   ui.logger.setLevel("DEBUG");
   ```

2. **æ£€æŸ¥é…ç½®**
   ```javascript
   console.log(ProjectConfig.get("logging.paths"));
   ```

3. **æ‰‹åŠ¨æµ‹è¯•**
   ```javascript
   // ç›´æ¥è°ƒç”¨æ ¸å¿ƒå‡½æ•°
   var result = ui.executeLogSave();
   console.log(result);
   ```

## ç‰ˆæœ¬å†å²

- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼Œå®ç°åŸºæœ¬æ—¥å¿—ä¿å­˜åŠŸèƒ½
- **v1.1.0** - æ·»åŠ é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- **v1.2.0** - ä¼˜åŒ–æ¨¡å—ç»“æ„å’Œæµ‹è¯•è¦†ç›–

## ç»´æŠ¤è¯´æ˜

- å®šæœŸæ£€æŸ¥ç›®æ ‡è·¯å¾„çš„ç£ç›˜ç©ºé—´
- ç›‘æ§æ—¥å¿—ä¿å­˜çš„æˆåŠŸç‡
- æ ¹æ®éœ€è¦è°ƒæ•´ä¿å­˜è·¯å¾„é…ç½®
- ä¿æŒæµ‹è¯•ç”¨ä¾‹çš„æ›´æ–°
