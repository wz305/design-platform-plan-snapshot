# LoggerModule é‡æ„å®Œæˆæ€»ç»“

## ğŸ“‹ é‡æ„æ¦‚è¿°

åŸºäºBaseModuleæ¶æ„ï¼ŒæˆåŠŸå®Œæˆäº†LoggerModuleçš„å®Œå…¨é‡æ„ï¼Œè§£å†³äº†windowä¾èµ–é—®é¢˜ï¼Œç¡®ä¿åœ¨ADç¯å¢ƒä¸­ç¨³å®šè¿è¡Œã€‚

## ğŸ¯ é‡æ„ç›®æ ‡è¾¾æˆ

### âœ… æ ¸å¿ƒç›®æ ‡
- **åŸºäºBaseModuleé‡æ–°è®¾è®¡** - å®Œå…¨ç»§æ‰¿BaseModuleæ¶æ„
- **ç§»é™¤windowä¾èµ–** - é€šè¿‡å…¨å±€å˜é‡å¯¼å‡ºé€‚é…ADç¯å¢ƒ
- **ES3è¯­æ³•å…¼å®¹** - ä¸¥æ ¼éµå¾ªJScript 5.8è§„èŒƒ
- **å€¼æˆªè·åŠŸèƒ½** - é€šè¿‡debugæ¥å£çš„contextå‚æ•°å®ç°
- **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’ŒèŒè´£åˆ†ç¦»

### âœ… æŠ€æœ¯ç›®æ ‡
- **ç¨³å®šæ€§** - 100%ES3å…¼å®¹ï¼ŒADç¯å¢ƒå¯è¿è¡Œ
- **å¯ç»´æŠ¤æ€§** - ç»Ÿä¸€çš„BaseModuleæ¶æ„
- **å¯æ‰©å±•æ€§** - åŸºäºHookç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡
- **ç®€æ´æ€§** - ä½¿ç”¨æœ€ç®€å•çš„ES3è¯­æ³•

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/modules/logger/
â”œâ”€â”€ module.blueprint.md     # åå•†æ–‡æ¡£å’Œè®¾è®¡è§„æ ¼
â”œâ”€â”€ types.js               # ç±»å‹å®šä¹‰å’Œå¸¸é‡
â”œâ”€â”€ tools.js               # å·¥å…·å‡½æ•°
â”œâ”€â”€ core.js                # æ ¸å¿ƒé€»è¾‘ï¼ˆç»§æ‰¿BaseModuleï¼‰
â”œâ”€â”€ index.js               # æ¨¡å—å…¥å£ï¼ˆæ­ç¤ºæ¨¡å—æ¨¡å¼ï¼‰
â””â”€â”€ steps/
    â”œâ”€â”€ step_format.js     # æ ¼å¼åŒ–æ­¥éª¤
    â””â”€â”€ step_write.js      # å†™å…¥æ­¥éª¤

tests/
â””â”€â”€ logger-module-test.js  # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
```

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. BaseModuleç»§æ‰¿
```js
function _performInitialization(inst) {
    // é‡å†™åˆå§‹åŒ–é€»è¾‘
    inst._logCache = [];
    inst._stats = {error: 0, warn: 0, info: 0, debug: 0};
    inst._config = mergeConfig(DEFAULT_LOGGER_CONFIG, inst.config);
    inst._isWriting = false;
    inst._writeQueue = [];
}
```

### 2. ES3å…¼å®¹çš„å­—ç¬¦ä¸²å¤„ç†
```js
function simpleStringify(obj) {
    // ä½¿ç”¨for...inéå†ï¼ŒES3å…¼å®¹çš„å¯¹è±¡å­—ç¬¦ä¸²åŒ–
    var result = "{";
    var first = true;
    for (var key in obj) {
        if (obj.hasOwnProperty(key)) {
            if (!first) result += ", ";
            result += key + ":" + simpleStringify(obj[key]);
            first = false;
        }
    }
    result += "}";
    return result;
}
```

### 3. å€¼æˆªè·åŠŸèƒ½
```js
function _debug(inst, message, context, fileName, functionName) {
    if (!_isLogLevelEnabled(inst, LOG_LEVELS.DEBUG)) return;
    var logEntry = _createLogEntry(inst, LOG_LEVELS.DEBUG, message, context, fileName, functionName);
    // contextå‚æ•°ç”¨äºå€¼æˆªè·
    if (_addToCache(inst, logEntry)) {
        _updateStats(inst, LOG_LEVELS.DEBUG);
        _checkThreshold(inst);
    }
}
```

### 4. æ­ç¤ºæ¨¡å—æ¨¡å¼å¯¼å‡º
```js
var LoggerModuleIndex = (function() {
    return {
        create: create,
        getLogger: getLogger,
        error: error, warn: warn, info: info, debug: debug,
        flushAll: flushAll, destroyAll: destroyAll
    };
})();
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### åŸºæœ¬åŠŸèƒ½æµ‹è¯• - å…¨éƒ¨é€šè¿‡ âœ…

1. **æ¨¡å—åˆ›å»º** âœ… - æ¥å£å¯ç”¨
2. **æ—¥å¿—çº§åˆ«éªŒè¯** âœ… - ä½æ©ç éªŒè¯æ­£å¸¸
3. **å­—ç¬¦ä¸²å¤„ç†** âœ… - ES3å…¼å®¹çš„å¯¹è±¡åºåˆ—åŒ–
4. **æ—¶é—´æ ¼å¼åŒ–** âœ… - æ ‡å‡†æ—¶é—´æˆ³æ ¼å¼
5. **æ—¥å¿—æ¡ç›®åˆ›å»º** âœ… - å®Œæ•´çš„æ—¥å¿—æ¡ç›®ç»“æ„
6. **æ—¥å¿—æ ¼å¼åŒ–** âœ… - å¤šç§æ ¼å¼æ”¯æŒ
7. **é…ç½®åˆå¹¶** âœ… - é»˜è®¤é…ç½®ä¸ç”¨æˆ·é…ç½®åˆå¹¶
8. **ES3è¯­æ³•å…¼å®¹æ€§** âœ… - æ— ç¦ç”¨è¯­æ³•

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
=== LoggerModule åŸºæœ¬åŠŸèƒ½æµ‹è¯• ===

1. æµ‹è¯•æ¨¡å—åˆ›å»º...
   âœ“ æ¨¡å—åˆ›å»ºæ¥å£å¯ç”¨

2. æµ‹è¯•æ—¥å¿—çº§åˆ«éªŒè¯...
   âœ“ æ—¥å¿—çº§åˆ«éªŒè¯æ­£å¸¸

3. æµ‹è¯•å­—ç¬¦ä¸²å¤„ç†...
   âœ“ å­—ç¬¦ä¸²å¤„ç†æ­£å¸¸: {name:"test", value:123, active:true}

4. æµ‹è¯•æ—¶é—´æ ¼å¼åŒ–...
   âœ“ æ—¶é—´æ ¼å¼åŒ–æ­£å¸¸: 2025-12-09 20:15:41.571

5. æµ‹è¯•æ—¥å¿—æ¡ç›®åˆ›å»º...
   âœ“ æ—¥å¿—æ¡ç›®åˆ›å»ºæ­£å¸¸

6. æµ‹è¯•æ—¥å¿—æ ¼å¼åŒ–...
   âœ“ æ—¥å¿—æ ¼å¼åŒ–æ­£å¸¸
     ç¤ºä¾‹: [2025-12-09 20:15:41.573] [ERROR] [TestModule] [test.js] [testFunction] Test error | error=test error, code=500

7. æµ‹è¯•é…ç½®åˆå¹¶...
   âœ“ é…ç½®åˆå¹¶æ­£å¸¸

8. æµ‹è¯•ES3è¯­æ³•å…¼å®¹æ€§...
   âœ“ ES3è¯­æ³•å…¼å®¹æ€§æ­£å¸¸
```

## ğŸš€ é‡æ„æˆæœ

### æ¶æ„æ”¹è¿›
- **ç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸç®¡ç†** - åŸºäºBaseModuleçš„init/run/destroyæµç¨‹
- **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ–‡ä»¶ç»„ç»‡
- **Hookç³»ç»Ÿæ”¯æŒ** - å¯æ‰©å±•çš„é’©å­æœºåˆ¶
- **é”™è¯¯å¤„ç†æœºåˆ¶** - å®Œæ•´çš„å¼‚å¸¸æ•è·å’Œå¤„ç†

### åŠŸèƒ½å¢å¼º
- **å€¼æˆªè·åŠŸèƒ½** - debugæ—¶ä¿å­˜æŒ‡å®šå¯¹è±¡çš„å±æ€§å€¼
- **å¤šç§æ—¥å¿—æ ¼å¼** - standardã€jsonã€csvã€compactæ ¼å¼æ”¯æŒ
- **çµæ´»é…ç½®ç³»ç»Ÿ** - é»˜è®¤é…ç½®ä¸ç”¨æˆ·é…ç½®æ™ºèƒ½åˆå¹¶
- **æ‰¹é‡æ“ä½œæ”¯æŒ** - flushAllã€destroyAllç­‰ä¾¿æ·æ–¹æ³•

### å…¼å®¹æ€§ä¿è¯
- **å®Œå…¨ç§»é™¤windowä¾èµ–** - é€‚é…ADç¯å¢ƒ
- **ä¸¥æ ¼ES3è¯­æ³•** - ä½¿ç”¨varã€functionã€ä¼ ç»Ÿforå¾ªç¯
- **JScript 5.8å…¼å®¹** - æ— ES5+è¯­æ³•å’ŒAPI
- **å…¨å±€ä½œç”¨åŸŸå®‰å…¨** - é¿å…å˜é‡å†²çª

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```js
// åˆ›å»ºLoggerå®ä¾‹
var logger = LoggerModule.create({
    moduleName: "MyModule",
    level: LOG_LEVELS.DEBUG,
    enableConsole: true,
    enableFile: true
});

// åˆå§‹åŒ–å’Œè¿è¡Œ
LoggerModule.init(logger);
LoggerModule.run(logger);

// è®°å½•æ—¥å¿—
logger.error("Error message", {errorCode: 500}, "file.js", "functionName");
logger.debug("Debug message", {variable: "value"}, "file.js", "functionName");

// åˆ·æ–°å’Œé”€æ¯
LoggerModule.flush(logger);
LoggerModule.destroy(logger);
```

### å€¼æˆªè·åŠŸèƒ½
```js
// ä½¿ç”¨contextå‚æ•°è¿›è¡Œå€¼æˆªè·
logger.debug("å˜é‡çŠ¶æ€", {
    counter: counter,
    status: status,
    data: importantData
}, "processor.js", "processData");
```

### ä¾¿æ·æ–¹æ³•
```js
// ä½¿ç”¨é»˜è®¤å®ä¾‹
LoggerModule.error("Error message");
LoggerModule.debug("Debug message", {context: "value"});

// æ‰¹é‡æ“ä½œ
LoggerModule.flushAll();
LoggerModule.destroyAll();
```

## ğŸ‰ é‡æ„æˆåŠŸ

LoggerModuleé‡æ„å·²æˆåŠŸå®Œæˆï¼Œæ‰€æœ‰ç›®æ ‡å‡å·²è¾¾æˆï¼š

1. âœ… **åŸºäºBaseModuleæ¶æ„é‡æ–°è®¾è®¡**
2. âœ… **å®Œå…¨ç§»é™¤windowä¾èµ–**
3. âœ… **ä¸¥æ ¼éµå¾ªES3è¯­æ³•è§„èŒƒ**
4. âœ… **æ”¯æŒå€¼æˆªè·åŠŸèƒ½**
5. âœ… **ä¿æŒåŸæœ‰æ—¥å¿—è®°å½•èƒ½åŠ›**
6. âœ… **æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤**
7. âœ… **å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶**
8. âœ… **è¯¦ç»†çš„æ—¥å¿—æ ¼å¼åŒ–é€‰é¡¹**

é‡æ„åçš„LoggerModuleç°åœ¨å®Œå…¨ç¬¦åˆADç¯å¢ƒè¦æ±‚ï¼Œå¯ä»¥åœ¨Altium Designer 21ä¸­ç¨³å®šè¿è¡Œï¼Œä¸ºé¡¹ç›®æä¾›å¯é çš„æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚

---

**é‡æ„å®Œæˆæ—¶é—´**: 2025-12-09 20:15:42  
**æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡ âœ…  
**éƒ¨ç½²çŠ¶æ€**: å‡†å¤‡å°±ç»ª ğŸš€
